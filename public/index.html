<!DOCTYPE html>
<html lang="en">
<head>
<title>Fuck you Kurt</title>
<script src="//code.jquery.com/jquery-2.2.3.min.js" charset="utf-8"
	type="text/javascript"></script>
<link rel="stylesheet"
	href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
<script
	src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"
	charset="utf-8" type="text/javascript"></script>
<script
	src="//cdn.jsdelivr.net/fingerprintjs2/1.1.3/fingerprint2.min.js"
	charset="utf-8" type="text/javascript"></script>
<script type="text/javascript" charset="utf-8">
	$(document).ready(function() {

		var userid = getParameterByName('userid');

		if (userid != '') {
			$('input#userid').val(userid);
			send(userid);
		}

		function track(account, userid, fingerprint) {
			var _sift = window._sift = window._sift || [];
			_sift.push([ '_setAccount', account ]);
			_sift.push([ '_setUserId', userid ]);
			_sift.push([ '_setSessionId', fingerprint ]);
			_sift.push([ '_trackPageview' ]);

			(function(d, s, id) {
				var e, f = d.getElementsByTagName(s)[0];
				if (d.getElementById(id)) {
					return;
				}
				e = d.createElement(s);
				e.id = id;
				e.src = 'https://cdn.siftscience.com/s.js';
				f.parentNode.insertBefore(e, f);
			})(document, 'script', 'sift-beacon');
			
			console.log('accountid:'+account);
		}

		function send(userid) {
			new Fingerprint2().get(function(fingerprint, components) {

				track('8099405ffa', userid, fingerprint);
				track('0026e0666a', userid, fingerprint);

				var data = {
					"userid" : userid,
					"deviceid" : fingerprint
				};
				
				console.log(data);

				console.log('userid=' + userid);
				console.log('deviceid=' + fingerprint);

				var jqxhr = $.post('//localhost:5000/login/', data, function() {
					alert("success");
				}).done(function() {
					alert("second success");
				}).fail(function() {
					alert("error");
				}).always(function() {
					alert("finished");
				});

			});
		}
	});

	function getParameterByName(name, url) {
		if (!url)
			url = window.location.href;
		name = name.replace(/[\[\]]/g, "\\$&");
		var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)", "i"), results = regex
				.exec(url);
		if (!results)
			return '';
		if (!results[2])
			return '';
		return decodeURIComponent(results[2].replace(/\+/g, " "));
	}
</script>

</head>
</body>

<div class="container">
	<div class="row">

		<form method="get" action="/">
			<div class="form-group">
				<label for="userid">User Id:</label> <input type="text"
					class="form-control" name="userid" id="userid" placeholder="423423"
					autocomplete="off" required>
			</div>
			<button type="submit" class="btn btn-primary btn-lg btn-block">Submit</button>
		</form>
		
		<pre class="hidden"></pre>

	</div>
</div>

</body>
</html>